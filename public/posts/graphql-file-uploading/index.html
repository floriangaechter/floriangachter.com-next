<!doctype html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="GraphQL File Uploading (Without Apollo…)
This quick tutorial explains how to upload files with GraphQL using only plain
JavaScript and no frameworks or libraries. It&rsquo;s not meant as a complete tutorial
as I won&rsquo;t be covering the backend side of the implementation.
The specs
A general specification for file uploads through GraphQL can be found on Github.
The idea is to send a multi-part form request
to the server which enables you to easily upload multiple files in one request." />
    <title>
      GraphQL File Uploading (Without Apollo…) | floriangaechter.com
    </title>
        
<link rel="stylesheet" href="/css/main.css" />
  
 
  </head>

  <body
    class="bg-flexoki-paper dark:bg-flexoki-black text-flexoki-black dark:text-flexoki-paper selection:bg-flexoki-black selection:text-flexoki-paper dark:selection:bg-flexoki-paper dark:selection:text-flexoki-black"
  >
    <div class="container mx-auto px-4">
      <nav class="flex py-4 border-b">
  <ul class="-ml-2 flex flex-wrap">
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="/"
        >Home</a
      >
    </li>
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="/about/"
        >About</a
      >
    </li>
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="/uses/"
        >Uses</a
      >
    </li>
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="/rss.xml"
        >RSS</a
      >
    </li>
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="https://mastodon.social/@neither1nor0"
        >Mastodon</a
      >
    </li>
    <li class="mt-2">
      <a
        class="p-1 ml-1 rounded hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800"
        href="https://github.com/floriangaechter/"
        >Github</a
      >
    </li>
  </ul>
  <ul class="flex flex-none ml-auto">
    <li class="mt-2">
      <button
        id="theme-toggle"
        type="button"
        class="flex hover:bg-flexoki-base-50 dark:hover:bg-flexoki-base-800 rounded p-1 ml-4 cursor-pointer"
        title="Theme"
        transition:persist
      >
        <svg
          id="theme-toggle-dark-icon"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="h-4 dark:hidden fill-current"
        >
          <title>Theme toggle dark</title>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
          ></path>
        </svg>
        <svg
          id="theme-toggle-light-icon"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-4 h-4 hidden dark:block fill-current"
        >
          <title>Theme toggle light</title>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
          ></path>
        </svg>
      </button>
    </li>
  </ul>
</nav>

      <div class="my-12">
<div
  class="prose prose-flexoki dark:prose-invert prose-headings:text-xl prose-headings:font-medium prose-lead:text-base"
>
  <h1 id="graphql-file-uploading-without-apollo">GraphQL File Uploading (Without Apollo…)</h1>
<p>This quick tutorial explains how to upload files with GraphQL using only plain
JavaScript and no frameworks or libraries. It&rsquo;s not meant as a complete tutorial
as I won&rsquo;t be covering the backend side of the implementation.</p>
<h2 id="the-specs">The specs</h2>
<p>A general specification for file uploads through GraphQL can be found <a href="https://github.com/jaydenseric/graphql-multipart-request-spec">on Github</a>.</p>
<p>The idea is to send a <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">multi-part form request</a>
to the server which enables you to easily upload multiple files in one request.</p>
<p>As the specs point out, the following GraphQL query should be sent to the
server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">query</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">mutation</span><span class="p">(</span><span class="nv">$file</span><span class="p">:</span><span class="w"> </span><span class="nc">Upload</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">singleUpload</span><span class="p">(</span><span class="py">file</span><span class="p">:</span><span class="w"> </span><span class="nv">$file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">`</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">variables</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">file</span><span class="p">:</span><span class="w"> </span><span class="nc">File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Which then will be uploaded as a multi-part form request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;operations&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{ &#34;query&#34;: &#34;mutation ($file: Upload!) { singleUpload(file: $file) { id } }&#34;, &#34;variables&#34;: { &#34;file&#34;: null } }
</span></span><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;map&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{ &#34;0&#34;: [&#34;variables.file&#34;] }
</span></span><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;0&#34;; filename=&#34;a.txt&#34;
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Alpha file content.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------------cec8e8123c05ba25--
</span></span></code></pre></div><h2 id="the-details">The details</h2>
<p>Let&rsquo;s have a look at the different parts of the form request.</p>
<ol>
<li>
<p><code>operations</code> contains the GraphQL query:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;operations&#34;
</span></span><span class="line"><span class="cl">{ &#34;query&#34;: &#34;mutation ($file: Upload!) { singleUpload(file: $file) { id } }&#34;, &#34;variables&#34;: { &#34;file&#34;: null } }
</span></span></code></pre></div></li>
<li>
<p><code>map</code> is responsible for the mapping between the file-variable in the GraphQL
query and the file attached to the request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;map&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{ &#34;0&#34;: [&#34;variables.file&#34;] }
</span></span></code></pre></div></li>
<li>
<p>And the file fields contain the actual files themselves:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">--------------------------cec8e8123c05ba25
</span></span><span class="line"><span class="cl">Content-Disposition: form-data; name=&#34;0&#34;; filename=&#34;a.txt&#34;
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Alpha file content.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------------cec8e8123c05ba25--
</span></span></code></pre></div></li>
</ol>
<p>So far so good. But how do we implement a request like this in plain JavaScript?</p>
<h2 id="the-client">The client</h2>
<p>Let&rsquo;s imagine we have the following HTML markup for a form:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;/graphql&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;myfile&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Upload<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>All we need to do is create a <code>formData</code> request like so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
</span></span></code></pre></div><p>Create the <code>operations</code> field, containing the GraphQL query, and append it to
the form request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">operations</span> <span class="o">=</span> <span class="sb">`{ &#34;query&#34;: &#34;mutation ($file: Upload!) { singleUpload(file: $file) { id } }&#34;, &#34;variables&#34;: { &#34;file&#34;: null } }`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;operations&#34;</span><span class="p">,</span> <span class="nx">operations</span><span class="p">);</span>
</span></span></code></pre></div><p>Add the <code>map</code> field with the variables and the actual file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="sb">`{&#34;0&#34;: [&#34;variables.file&#34;]}`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;map&#34;</span><span class="p">,</span> <span class="nx">map</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;0&#34;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span></code></pre></div><p><em>For the sake of this example, I referenced the file directly from the form,
assuming the upload is triggered by an event.</em></p>
<p>And lastly, send it to the server, using <code>fetch()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;/graphql&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;post&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>If all goes well and your server is implemented according to the previously
mentioned specification, you should be able to upload files with just plain old
JavaScript. No need for a fancy library or framework. Which doesn&rsquo;t mean that
those frameworks are bad, by the way&hellip; I just feel sometimes it&rsquo;s not needed.</p>
<h2 id="multiple-files">Multiple files</h2>
<p>In case you want to upload multiple files, all we have to do is modify the
GraphQL query to contain a list of files instead of just one file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">query</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">mutation</span><span class="p">(</span><span class="nv">$file</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nc">Upload</span><span class="p">!]!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">multipleUpload</span><span class="p">(</span><span class="py">files</span><span class="p">:</span><span class="w"> </span><span class="nv">$files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">`</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">variables</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">files</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">File</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Define the operations part:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">operations</span> <span class="o">=</span> <span class="sb">`{ &#34;query&#34;: &#34;mutation ($files: [Upload!]!) { multipleUpload(files: $files) { id } }&#34;, &#34;variables&#34;: { &#34;files&#34;: [null, null] } }`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;operations&#34;</span><span class="p">,</span> <span class="nx">operations</span><span class="p">);</span>
</span></span></code></pre></div><p>Add the mappings between the files and the variables to the <code>map</code> operation and
append the files:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="sb">`{&#34;0&#34;: [&#34;variables.files.0&#34;], &#34;1&#34;: [&#34;variables.files.1&#34;]}`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;map&#34;</span><span class="p">,</span> <span class="nx">map</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;0&#34;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span></code></pre></div><p>The rest is the same as the one-file example.</p>

</div>
</div>
      <div class="prose prose-flexoki dark:prose-invert prose-sm max-w-none mb-6">
  © 2025 Copyright Florian Gächter. All rights reserved. This
  site is hosted on <a href="https://uberspace.de/">Uberspace</a>.
</div>

    </div>

      
<script src="/js/theme.js"></script>
 

  </body>
</html>
